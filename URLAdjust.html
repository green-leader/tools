<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adjust URL's</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    Sometimes adjusting URLs on your phone sucks.
    <br>
    Rather opinionated as well.
    <br>
    <form onsubmit="return false;">
      <input type="text" id="url" placeholder="https://example.com">
      <input type="submit" id="btnSubmit" value="Submit">
      <button onclick="copyFunction()">Copy Text</button>
      <br>
      <input type="radio" id="markdown" name="formatStyle" value="markdown" checked>
      <label for="markdown">Markdown</label>
      <input type="radio" id="raw" name="formatStyle" value="raw">
      <label for="raw">Raw Link</label>
    </form>
    <input type="checkbox" id="params" name="params" value="true" checked="">
    <label for="params">Strip Params</label>
    <br>
    <div id="output"></div>

    <script>
function copyFunction() {
    var copyText = document.getElementById("output");
    navigator.clipboard.writeText(copyText.innerHTML);
}

function stripParams(url) {
  const result = url.split('?')[0];
  return result;
}

function formatMarkdown(url) {
  let linkText = url.replace(/\:\/\/www./i, "\:\/\/")
  .replace(/https\:\/\/|http\:\/\//i, "")
  .replace(/reddit.com|old.reddit.com/i, "");
  linkText = stripParams(linkText);
  // [example.com](https://example.com)
  let returnValue = "[" + (linkText) + "](" + (url) + ")";
  document.getElementById("output").innerHTML = returnValue;
}
 
function formatRaw(url) {
  let returnValue = url;
  document.getElementById("output").innerHTML = returnValue;
}

function formatSelection() {
  let formatSelect;
  const radioButtons = document.querySelectorAll('input[name="formatStyle"]');
  for (const radioButton of radioButtons) {
    if (radioButton.checked) {
      formatSelect = radioButton.value;
      break;
    }
  }
  let url = document.getElementById('url').value;
  if (url == "") {
    return;
  }
  if (document.getElementById('params').checked) {
    url = stripParams(url)
  }
  if ( formatSelect === "markdown"){
    formatMarkdown(url);
  }
  if ( formatSelect === "raw"){
    formatRaw(url);
  }
}

let urlForm = document.getElementById('url');
urlForm.addEventListener("keyup", (event) => {
  if (event.code !== 'Enter' && event.code !== 'NumpadEnter')
  {
    return;
  }
  formatSelection();
});

let buttonSubmit = document.getElementById('btnSubmit');
buttonSubmit.addEventListener("click", (event) => {
  formatSelection();
});

    </script>
  </body>
</html>